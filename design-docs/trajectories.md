# Trajectories 2: Better Edition

## Problem 

WPILib currently has a very limited trajectory API;
it only allows for cubic or quintic splines,
and only for tangential heading interpolation.
This works for differential drive robots,
but holonomic robots are able to follow more complex trajectories.

This document describes a new trajectory API that can be used
by both differential drive and holonomic robots.

## Goals 

1. Define a trajectory API that can represent a wide variety of trajectories,
   including those generated by Choreo and PathPlanner.
2. Allow future trajectory generation algorithms to be added
   without changing the API.
3. Serialize and deserialize trajectories in both JSON and WPILib struct formats.

## Non-Goals

1. Replace tools like Choreo and PathPlanner. 
   The new Trajectory API is intended to be used by those tools,
   not to replace them. 
   These tools should have their Trajectory classes extend `Trajectory` as detailed below.
2. Implement a full trajectory following or generation system.
   This document only describes the trajectory API.

## Design: Trajectory API

The core of the trajectory API is the `Trajectory` class.
It is generic over the type of `TrajectorySample` used to represent a trajectory sample;
this allows for different types of trajectory generation algorithms to be used'
for different types of robots.

The `Trajectory` class will look like this:

```java
public abstract class Trajectory<SampleType extends Trajectory.Sample> {
    public SampleType get(Time time);
    
    public abstract SampleType interpolate(SampleType start, SampleType end, double t);
    
    public abstract Trajectory<SampleType> concatenate(Trajectory<SampleType> other);
    
    public abstract Trajectory<SampleType> relativeTo(Pose2d other);
    
    public abstract Trajectory<SampleType> transformBy(Transform2d other);
    
    public static abstract class Sample {
        public final Time timestamp;
        public final Pose2d pose;
        public final ChassisSpeeds velocity;
        public final ChassisAcceleration acceleration;
    }
}
```

There will likely be other methods for convenience,
but the above methods are the core of the API.

The `SampleType` class will be generic over the type of sample used by the trajectory.
This allows for different types of trajectory generation algorithms to be used
for different types of robots;
`DifferentialDriveTrajectory` will use `DifferentialSample`, 
which contains a `DifferentialDriveWheelSpeeds` object,
`MecanumDriveTrajectory` will use `MecanumSample`,
which contains a `MecanumDriveWheelSpeeds` object,
and so on.

The individual trajectory classes will also contain their respective kinematics class
to properly interpolate the samples.


## Design: Serialization

The trajectory API will be serialized using JSON so that external tools can create
valid trajectories for use with WPILib.

For each type of trajectory, 
the JSON file will contain enough information to create the respective `Kinematics` object,
followed by a list of `SampleType` objects.