# Trajectories 2: Better Edition

## Problem 

WPILib currently has a very limited trajectory API;
it only allows for cubic or quintic splines,
and only for tangential heading interpolation.
This works for differential drive robots,
but holonomic robots are able to follow more complex trajectories.

This document describes a new trajectory API that can be used
by both differential drive and holonomic robots.

## Goals 

1. Define a trajectory API that can represent a wide variety of trajectories,
   including those generated by Choreo and PathPlanner.
2. Allow future trajectory generation algorithms to be added
   without changing the API.
3. Serialize and deserialize trajectories in both JSON and WPILib struct formats.

## Non-Goals

1. Replace tools like Choreo and PathPlanner. 
   The new Trajectory API is intended to be used by those tools,
   not to replace them. 
   These tools should have their Trajectory classes extend `Trajectory` as detailed below.
2. Implement a full trajectory following or generation system.
   This document only describes the trajectory API.

## Design: Trajectory API

External libraries such as Choreo and PathPlanner should be able to
generate trajectories that extend the `Trajectory` class presented here,
to allow for users to add external trajectory generation algorithms
without changing their trajectory *following* code.

There are a few new classes that this API will use:

### ChassisAcceleration 

The `ChassisAcceleration` class represents the acceleration of a chassis.
It is basically just ChassisSpeeds except it is for accelerations instead of velocities:

```java
public class ChassisAccelerations {
    public final double ax;
    public final double ay;
    public final double alpha;
    
    /* constructors and stuff */
}
```

Kinematics classes will be updated to include acceleration kinematics as well.

### Sample 

The `Sample` class represents a single point on a trajectory.
It contains the position, velocity, and acceleration of the chassis
at that point, as well as the time at which the point occurs.

It is implemented as a static inner class of `Trajectory`.

```java
public static class Sample {
    public final double time;
    public final Pose2d pose;
    public final ChassisSpeeds chassisSpeeds;
    public final ChassisAccelerations chassisAccelerations;
    
    /* constructors and stuff */
}
```

A `DifferentialSample` class will be used to represent a sample
for a differential drive robot, 
which extends `Sample` and calculates the left and right wheel speeds
given the chassis speeds and the drivetrain kinematics.

Similarly, `SwerveSample` and `MecanumSample` classes will be used
for holonomic robots and include calculations for motor powers there.

### Trajectory

The `Trajectory` class represents a trajectory,
which will be implemented as a list of `Sample`s
that are linearly interpolated between.

The following methods will be implemented as 
part of the public API of the `Trajectory` class:

```java
public class Trajectory {
    public Time duration();
    
    public Sample sampleAt(double time);
    public Pose2d poseAt(double time);
}
```
